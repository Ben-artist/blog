<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pnpm深度解析：现代包管理器的革命性突破 | TSK</title>
    <meta name="description" content="深入解析pnpm的技术原理、核心优势以及如何解决传统包管理器的痛点。">
    <meta name="generator" content="VitePress v2.0.0-alpha.11">
    <link rel="preload stylesheet" href="/blog/assets/style.BrNpTd-l.css" as="style">
    <link rel="preload stylesheet" href="/blog/vp-icons.css" as="style">
    
    <script type="module" src="/blog/assets/app.DYOAuMv8.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.BUXTglGw.js">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.DPO_DQk3.js">
    <link rel="modulepreload" href="/blog/assets/posts_pnpm-deep-dive.md.CXWetFIX.lean.js">
    <link rel="icon" type="image/png" href="https://power-mall-2.oss-cn-beijing.aliyuncs.com/avator.png">
    <meta name="author" content="TSK">
    <meta property="og:title" content="Home">
    <meta property="og:description" content="Home of TSK">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-921fbe14 data-v-5c305cf1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0ce2acc1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0ce2acc1>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5c305cf1 data-v-828124ca><div class="VPNavBar" data-v-828124ca data-v-a6985511><div class="wrapper" data-v-a6985511><div class="container" data-v-a6985511><div class="title" data-v-a6985511><div class="VPNavBarTitle" data-v-a6985511 data-v-a6dc18c0><a class="title" href="/blog/" data-v-a6dc18c0><!--[--><!--]--><!----><span data-v-a6dc18c0>TSK</span><!--[--><!--]--></a></div></div><div class="content" data-v-a6985511><div class="content-body" data-v-a6985511><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a6985511><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a6985511 data-v-4594c104><span id="main-nav-aria-label" class="visually-hidden" data-v-4594c104> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/" tabindex="0" data-v-4594c104 data-v-fc2e884e><!--[--><span data-v-fc2e884e>🏡Blogs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/tags.html" tabindex="0" data-v-4594c104 data-v-fc2e884e><!--[--><span data-v-fc2e884e>🔖Tags</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/archives.html" tabindex="0" data-v-4594c104 data-v-fc2e884e><!--[--><span data-v-fc2e884e>📃Archives</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a6985511 data-v-af85b417><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af85b417 data-v-bfda6320 data-v-094806d9><span class="check" data-v-094806d9><span class="icon" data-v-094806d9><!--[--><span class="vpi-sun sun" data-v-bfda6320></span><span class="vpi-moon moon" data-v-bfda6320></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a6985511 data-v-7fd52932 data-v-56ae26a9><!--[--><a class="VPSocialLink no-icon" href="https://github.com/tangtts" aria-label="github" target="_blank" rel="me noopener" data-v-56ae26a9 data-v-b049ad9d><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/home?locale=zh-cn" aria-label="twitter" target="_blank" rel="me noopener" data-v-56ae26a9 data-v-b049ad9d><span class="vpi-social-twitter"></span></a><a class="VPSocialLink no-icon" href="mailto:tskwangyi@gmail.com" aria-label target="_blank" rel="me noopener" data-v-56ae26a9 data-v-b049ad9d><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
          <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
          </svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a6985511 data-v-f1b45d4e data-v-6478141f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6478141f><span class="vpi-more-horizontal icon" data-v-6478141f></span></button><div class="menu" data-v-6478141f><div class="VPMenu" data-v-6478141f data-v-7001ea82><!----><!--[--><!--[--><!----><div class="group" data-v-f1b45d4e><div class="item appearance" data-v-f1b45d4e><p class="label" data-v-f1b45d4e>Appearance</p><div class="appearance-action" data-v-f1b45d4e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f1b45d4e data-v-bfda6320 data-v-094806d9><span class="check" data-v-094806d9><span class="icon" data-v-094806d9><!--[--><span class="vpi-sun sun" data-v-bfda6320></span><span class="vpi-moon moon" data-v-bfda6320></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f1b45d4e><div class="item social-links" data-v-f1b45d4e><div class="VPSocialLinks social-links-list" data-v-f1b45d4e data-v-56ae26a9><!--[--><a class="VPSocialLink no-icon" href="https://github.com/tangtts" aria-label="github" target="_blank" rel="me noopener" data-v-56ae26a9 data-v-b049ad9d><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/home?locale=zh-cn" aria-label="twitter" target="_blank" rel="me noopener" data-v-56ae26a9 data-v-b049ad9d><span class="vpi-social-twitter"></span></a><a class="VPSocialLink no-icon" href="mailto:tskwangyi@gmail.com" aria-label target="_blank" rel="me noopener" data-v-56ae26a9 data-v-b049ad9d><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
          <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
          </svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a6985511 data-v-c2753b1e><span class="container" data-v-c2753b1e><span class="top" data-v-c2753b1e></span><span class="middle" data-v-c2753b1e></span><span class="bottom" data-v-c2753b1e></span></span></button></div></div></div></div><div class="divider" data-v-a6985511><div class="divider-line" data-v-a6985511></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5c305cf1 data-v-84e6427c><div class="container" data-v-84e6427c><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-84e6427c data-v-f21c8b90><button data-v-f21c8b90>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5c305cf1 data-v-c915dc7a><div class="VPDoc" data-v-c915dc7a data-v-cd9e52ac><!--[--><!--]--><div class="container" data-v-cd9e52ac><!----><div class="content" data-v-cd9e52ac><div class="content-container" data-v-cd9e52ac><!--[--><!--[--><!--[--><!--[--><h1 class="title" data-v-ac80d3c4>pnpm深度解析：现代包管理器的革命性突破</h1><div class="date" data-v-ac80d3c4>🕒 Published at: </div><!--]--><!----><!--]--><!--]--><!--]--><main class="main" data-v-cd9e52ac><div style="position:relative;" class="vp-doc _blog_posts_pnpm-deep-dive" data-v-cd9e52ac><div><p>在JavaScript生态系统中，包管理器扮演着至关重要的角色。从npm到yarn，再到如今的pnpm，包管理器的发展历程反映了前端工程化的重要演进。</p><hr><h2 id="_1-pnpm的起源与背景" tabindex="-1">1. pnpm的起源与背景 <a class="header-anchor" href="#_1-pnpm的起源与背景" aria-label="Permalink to “1. pnpm的起源与背景”">​</a></h2><h3 id="_1-1-为什么需要pnpm" tabindex="-1">1.1 为什么需要pnpm？ <a class="header-anchor" href="#_1-1-为什么需要pnpm" aria-label="Permalink to “1.1 为什么需要pnpm？”">​</a></h3><p>在pnpm出现之前，npm和yarn虽然解决了JavaScript包管理的基本需求，但在实际使用中暴露出了诸多问题：</p><ul><li><strong>磁盘空间浪费</strong>：每个项目都重复安装相同的依赖</li><li><strong>安装速度慢</strong>：需要下载和复制大量重复文件</li><li><strong>幽灵依赖问题</strong>：可以访问未声明的依赖</li><li><strong>扁平化结构复杂</strong>：node_modules结构混乱</li><li><strong>安全性问题</strong>：依赖关系不明确</li></ul><h3 id="_1-2-pnpm的诞生" tabindex="-1">1.2 pnpm的诞生 <a class="header-anchor" href="#_1-2-pnpm的诞生" aria-label="Permalink to “1.2 pnpm的诞生”">​</a></h3><p>pnpm（Performant NPM）由Zoltan Kochan于2017年创建，其核心理念是：</p><blockquote><p>&quot;Fast, disk space efficient package manager&quot;</p></blockquote><hr><h2 id="_2-pnpm的核心优势" tabindex="-1">2. pnpm的核心优势 <a class="header-anchor" href="#_2-pnpm的核心优势" aria-label="Permalink to “2. pnpm的核心优势”">​</a></h2><h3 id="_2-1-磁盘空间效率" tabindex="-1">2.1 磁盘空间效率 <a class="header-anchor" href="#_2-1-磁盘空间效率" aria-label="Permalink to “2.1 磁盘空间效率”">​</a></h3><h4 id="传统包管理器的问题" tabindex="-1">传统包管理器的问题 <a class="header-anchor" href="#传统包管理器的问题" aria-label="Permalink to “传统包管理器的问题”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># npm/yarn的存储方式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">project1/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    lodash@4.17.21/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">     # 1.2MB</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    react@18.2.0/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">       # 2.1MB</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">project2/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    lodash@4.17.21/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">     # 1.2MB (重复)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    react@18.2.0/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">       # 2.1MB (重复)</span></span></code></pre></div><h4 id="pnpm的解决方案" tabindex="-1">pnpm的解决方案 <a class="header-anchor" href="#pnpm的解决方案" aria-label="Permalink to “pnpm的解决方案”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pnpm的存储方式</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">~</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/.pnpm-store/          </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 全局存储</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  lodash@4.17.21/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">       # 1.2MB (只存储一份)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  react@18.2.0/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">         # 2.1MB (只存储一份)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">project1/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    lodash</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.pnpm-store/lodash@4.17.21/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 硬链接</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">project2/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    lodash</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.pnpm-store/lodash@4.17.21/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 硬链接</span></span></code></pre></div><p><strong>实际效果对比：</strong></p><ul><li>100个项目使用相同依赖：npm/yarn需要100倍空间，pnpm只需要1倍空间</li><li>大型项目节省空间可达90%以上</li></ul><h3 id="_2-2-安装速度优势" tabindex="-1">2.2 安装速度优势 <a class="header-anchor" href="#_2-2-安装速度优势" aria-label="Permalink to “2.2 安装速度优势”">​</a></h3><h4 id="速度对比测试" tabindex="-1">速度对比测试 <a class="header-anchor" href="#速度对比测试" aria-label="Permalink to “速度对比测试”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试环境：1000个依赖包</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">npm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    45.2s</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yarn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   38.7s</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   12.3s</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 快3-4倍</span></span></code></pre></div><h4 id="为什么pnpm这么快" tabindex="-1">为什么pnpm这么快？ <a class="header-anchor" href="#为什么pnpm这么快" aria-label="Permalink to “为什么pnpm这么快？”">​</a></h4><ol><li><strong>硬链接机制</strong>：不需要复制文件，只需创建链接</li><li><strong>并行安装</strong>：充分利用多核CPU</li><li><strong>智能缓存</strong>：基于内容寻址的缓存策略</li><li><strong>减少I/O操作</strong>：避免大量文件复制</li></ol><h3 id="_2-3-严格的依赖管理" tabindex="-1">2.3 严格的依赖管理 <a class="header-anchor" href="#_2-3-严格的依赖管理" aria-label="Permalink to “2.3 严格的依赖管理”">​</a></h3><h4 id="幽灵依赖问题" tabindex="-1">幽灵依赖问题 <a class="header-anchor" href="#幽灵依赖问题" aria-label="Permalink to “幽灵依赖问题”">​</a></h4><p><strong>npm/yarn的问题：</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// package.json</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">  &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dependencies</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">    &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">express</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^4.18.2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 可以访问未声明的依赖（幽灵依赖）</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> lodash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> require</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">lodash</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // ❌ 危险！</span></span></code></pre></div><p><strong>pnpm的解决方案：</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 使用pnpm，只能访问声明的依赖</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> express</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> require</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">express</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // ✅ 正常</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> lodash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> require</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">lodash</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // ❌ 报错！</span></span></code></pre></div><hr><h2 id="_3-pnpm的技术原理" tabindex="-1">3. pnpm的技术原理 <a class="header-anchor" href="#_3-pnpm的技术原理" aria-label="Permalink to “3. pnpm的技术原理”">​</a></h2><h3 id="_3-1-内容寻址存储" tabindex="-1">3.1 内容寻址存储 <a class="header-anchor" href="#_3-1-内容寻址存储" aria-label="Permalink to “3.1 内容寻址存储”">​</a></h3><p>pnpm使用内容寻址存储（Content-Addressable Storage）来管理包：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 包的存储路径基于其内容的哈希值</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">~</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/.pnpm-store/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  files/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    hash1/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 基于包内容计算的哈希</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    hash2/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    hash3/</span></span></code></pre></div><p><strong>优势：</strong></p><ul><li>相同内容的包只存储一份</li><li>支持去重和验证</li><li>提高缓存命中率</li></ul><h3 id="_3-2-符号链接和硬链接" tabindex="-1">3.2 符号链接和硬链接 <a class="header-anchor" href="#_3-2-符号链接和硬链接" aria-label="Permalink to “3.2 符号链接和硬链接”">​</a></h3><h4 id="硬链接-hard-links" tabindex="-1">硬链接（Hard Links） <a class="header-anchor" href="#硬链接-hard-links" aria-label="Permalink to “硬链接（Hard Links）”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建硬链接</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> package.json</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> package.json.link</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 硬链接特点：</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 1. 指向同一个inode</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 2. 删除原文件不影响链接</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 3. 节省磁盘空间</span></span></code></pre></div><h4 id="符号链接-symbolic-links" tabindex="-1">符号链接（Symbolic Links） <a class="header-anchor" href="#符号链接-symbolic-links" aria-label="Permalink to “符号链接（Symbolic Links）”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pnpm使用符号链接构建依赖树</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">project/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    express</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../../.pnpm-store/express@4.18.2/node_modules/express</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    lodash</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../../.pnpm-store/lodash@4.17.21/node_modules/lodash</span></span></code></pre></div><h3 id="_3-3-依赖树结构" tabindex="-1">3.3 依赖树结构 <a class="header-anchor" href="#_3-3-依赖树结构" aria-label="Permalink to “3.3 依赖树结构”">​</a></h3><h4 id="npm-yarn的扁平化结构" tabindex="-1">npm/yarn的扁平化结构 <a class="header-anchor" href="#npm-yarn的扁平化结构" aria-label="Permalink to “npm/yarn的扁平化结构”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  express/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  lodash/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 直接可访问</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  body-parser/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 直接可访问</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  .bin/</span></span></code></pre></div><h4 id="pnpm的嵌套结构" tabindex="-1">pnpm的嵌套结构 <a class="header-anchor" href="#pnpm的嵌套结构" aria-label="Permalink to “pnpm的嵌套结构”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  .pnpm/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    express@4.18.2/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        express/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        body-parser/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # express的依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    lodash@4.17.21/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        lodash/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  express</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .pnpm/express@4.18.2/node_modules/express</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  lodash</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .pnpm/lodash@4.17.21/node_modules/lodash</span></span></code></pre></div><hr><h2 id="_4-与npm-yarn的详细对比" tabindex="-1">4. 与npm/yarn的详细对比 <a class="header-anchor" href="#_4-与npm-yarn的详细对比" aria-label="Permalink to “4. 与npm/yarn的详细对比”">​</a></h2><h3 id="_4-1-功能对比表" tabindex="-1">4.1 功能对比表 <a class="header-anchor" href="#_4-1-功能对比表" aria-label="Permalink to “4.1 功能对比表”">​</a></h3><table tabindex="0"><thead><tr><th>特性</th><th>npm</th><th>yarn</th><th>pnpm</th></tr></thead><tbody><tr><td>安装速度</td><td>慢</td><td>中等</td><td>快</td></tr><tr><td>磁盘空间</td><td>浪费</td><td>浪费</td><td>高效</td></tr><tr><td>幽灵依赖</td><td>存在</td><td>存在</td><td>解决</td></tr><tr><td>循环依赖检测</td><td>弱</td><td>中等</td><td>强</td></tr><tr><td>并行安装</td><td>部分支持</td><td>支持</td><td>完全支持</td></tr><tr><td>离线模式</td><td>基础</td><td>完善</td><td>完善</td></tr><tr><td>工作空间</td><td>基础</td><td>支持</td><td>原生支持</td></tr></tbody></table><h3 id="_4-2-性能对比" tabindex="-1">4.2 性能对比 <a class="header-anchor" href="#_4-2-性能对比" aria-label="Permalink to “4.2 性能对比”">​</a></h3><h4 id="安装时间对比" tabindex="-1">安装时间对比 <a class="header-anchor" href="#安装时间对比" aria-label="Permalink to “安装时间对比”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试项目：React + TypeScript + 50个依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">npm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    2分30秒</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yarn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   1分45秒</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   45秒</span></span></code></pre></div><h4 id="磁盘空间对比" tabindex="-1">磁盘空间对比 <a class="header-anchor" href="#磁盘空间对比" aria-label="Permalink to “磁盘空间对比”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试项目：Vue3 + Vite + 100个依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">npm:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    156MB</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yarn:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   148MB</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   23MB</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 节省85%空间</span></span></code></pre></div><hr><h2 id="_5-pnpm的高级特性" tabindex="-1">5. pnpm的高级特性 <a class="header-anchor" href="#_5-pnpm的高级特性" aria-label="Permalink to “5. pnpm的高级特性”">​</a></h2><h3 id="_5-1-工作空间-workspaces" tabindex="-1">5.1 工作空间（Workspaces） <a class="header-anchor" href="#_5-1-工作空间-workspaces" aria-label="Permalink to “5.1 工作空间（Workspaces）”">​</a></h3><h4 id="原生工作空间支持" tabindex="-1">原生工作空间支持 <a class="header-anchor" href="#原生工作空间支持" aria-label="Permalink to “原生工作空间支持”">​</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pnpm-workspace.yaml</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">packages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">packages/*</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apps/*</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">!**/test/**</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span></code></pre></div><h4 id="依赖提升策略" tabindex="-1">依赖提升策略 <a class="header-anchor" href="#依赖提升策略" aria-label="Permalink to “依赖提升策略”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 自动提升公共依赖到根目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">packages/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  app1/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    package.json</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 依赖react</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  app2/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    package.json</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 依赖react</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pnpm自动提升react到根目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">node_modules/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  react/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 提升的公共依赖</span></span></code></pre></div><h3 id="_5-2-依赖过滤" tabindex="-1">5.2 依赖过滤 <a class="header-anchor" href="#_5-2-依赖过滤" aria-label="Permalink to “5.2 依赖过滤”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 只安装生产依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 只安装开发依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 过滤特定包</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --filter=app1</span></span></code></pre></div><h3 id="_5-3-脚本管理" tabindex="-1">5.3 脚本管理 <a class="header-anchor" href="#_5-3-脚本管理" aria-label="Permalink to “5.3 脚本管理”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 并行运行脚本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --parallel</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 按依赖顺序运行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --recursive</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 条件运行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --if-present</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test</span></span></code></pre></div><hr><h2 id="_6-迁移指南" tabindex="-1">6. 迁移指南 <a class="header-anchor" href="#_6-迁移指南" aria-label="Permalink to “6. 迁移指南”">​</a></h2><h3 id="_6-1-从npm迁移" tabindex="-1">6.1 从npm迁移 <a class="header-anchor" href="#_6-1-从npm迁移" aria-label="Permalink to “6.1 从npm迁移”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 1. 安装pnpm</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">npm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -g</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 2. 删除现有node_modules</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -rf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> node_modules</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> package-lock.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 3. 使用pnpm安装</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 4. 更新脚本</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># package.json</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  &quot;scripts&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    &quot;install&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm install</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    &quot;add&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm add</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    &quot;remove&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm remove</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre></div><h3 id="_6-2-从yarn迁移" tabindex="-1">6.2 从yarn迁移 <a class="header-anchor" href="#_6-2-从yarn迁移" aria-label="Permalink to “6.2 从yarn迁移”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 1. 删除yarn.lock和node_modules</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -rf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> node_modules</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yarn.lock</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 2. 使用pnpm安装</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 3. 更新CI/CD配置</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># .github/workflows/ci.yml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dependencies</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  run:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span></code></pre></div><h3 id="_6-3-团队协作" tabindex="-1">6.3 团队协作 <a class="header-anchor" href="#_6-3-团队协作" aria-label="Permalink to “6.3 团队协作”">​</a></h3><h4 id="锁定文件" tabindex="-1">锁定文件 <a class="header-anchor" href="#锁定文件" aria-label="Permalink to “锁定文件”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pnpm-lock.yaml 确保团队依赖一致</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 提交到版本控制</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm-lock.yaml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Add pnpm lock file</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre></div><h4 id="ci-cd集成" tabindex="-1">CI/CD集成 <a class="header-anchor" href="#ci-cd集成" aria-label="Permalink to “CI/CD集成”">​</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># GitHub Actions</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CI</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pull_request</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">jobs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  test</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    runs-on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    steps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> actions/checkout@v3</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm/action-setup@v2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        with</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">          version</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        with</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">          node-version</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">18</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">          cache</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm install</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm test</span></span></code></pre></div><hr><h2 id="_7-最佳实践" tabindex="-1">7. 最佳实践 <a class="header-anchor" href="#_7-最佳实践" aria-label="Permalink to “7. 最佳实践”">​</a></h2><h3 id="_7-1-项目配置" tabindex="-1">7.1 项目配置 <a class="header-anchor" href="#_7-1-项目配置" aria-label="Permalink to “7.1 项目配置”">​</a></h3><h4 id="npmrc配置" tabindex="-1">.npmrc配置 <a class="header-anchor" href="#npmrc配置" aria-label="Permalink to “.npmrc配置”">​</a></h4><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># .npmrc</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">shamefully-hoist</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">false</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">strict-peer-dependencies</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">false</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">auto-install-peers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span></code></pre></div><h4 id="脚本优化" tabindex="-1">脚本优化 <a class="header-anchor" href="#脚本优化" aria-label="Permalink to “脚本优化”">​</a></h4><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">scripts</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">preinstall</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">npx only-allow pnpm</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dev</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm run --parallel dev</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">build</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm run --recursive build</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">test</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pnpm run --recursive test</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h3 id="_7-2-依赖管理策略" tabindex="-1">7.2 依赖管理策略 <a class="header-anchor" href="#_7-2-依赖管理策略" aria-label="Permalink to “7.2 依赖管理策略”">​</a></h3><h4 id="版本锁定" tabindex="-1">版本锁定 <a class="header-anchor" href="#版本锁定" aria-label="Permalink to “版本锁定”">​</a></h4><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dependencies</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">react</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">18.2.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        // 精确版本</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">lodash</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^4.17.21</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      // 兼容版本</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h4 id="安全更新" tabindex="-1">安全更新 <a class="header-anchor" href="#安全更新" aria-label="Permalink to “安全更新”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查安全漏洞</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> audit</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 自动修复</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> audit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --fix</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 更新依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> update</span></span></code></pre></div><hr><h2 id="_8-常见问题与解决方案" tabindex="-1">8. 常见问题与解决方案 <a class="header-anchor" href="#_8-常见问题与解决方案" aria-label="Permalink to “8. 常见问题与解决方案”">​</a></h2><h3 id="_8-1-兼容性问题" tabindex="-1">8.1 兼容性问题 <a class="header-anchor" href="#_8-1-兼容性问题" aria-label="Permalink to “8.1 兼容性问题”">​</a></h3><h4 id="符号链接问题" tabindex="-1">符号链接问题 <a class="header-anchor" href="#符号链接问题" aria-label="Permalink to “符号链接问题”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Windows下可能需要管理员权限</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 或者使用mklink命令</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mklink</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /D</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> node_modules</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .pnpm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ode_modules</span></span></code></pre></div><h4 id="构建工具兼容" tabindex="-1">构建工具兼容 <a class="header-anchor" href="#构建工具兼容" aria-label="Permalink to “构建工具兼容”">​</a></h4><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// Vite配置</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">export</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> default</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  optimizeDeps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    include</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">lodash</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // 预构建依赖</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h3 id="_8-2-性能优化" tabindex="-1">8.2 性能优化 <a class="header-anchor" href="#_8-2-性能优化" aria-label="Permalink to “8.2 性能优化”">​</a></h3><h4 id="缓存配置" tabindex="-1">缓存配置 <a class="header-anchor" href="#缓存配置" aria-label="Permalink to “缓存配置”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 配置缓存目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> store-dir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.pnpm-store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 清理缓存</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> store</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prune</span></span></code></pre></div><h4 id="并行安装优化" tabindex="-1">并行安装优化 <a class="header-anchor" href="#并行安装优化" aria-label="Permalink to “并行安装优化”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置并发数</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --network-concurrency=4</span></span></code></pre></div><hr><h2 id="_9-未来发展趋势" tabindex="-1">9. 未来发展趋势 <a class="header-anchor" href="#_9-未来发展趋势" aria-label="Permalink to “9. 未来发展趋势”">​</a></h2><h3 id="_9-1-生态系统发展" tabindex="-1">9.1 生态系统发展 <a class="header-anchor" href="#_9-1-生态系统发展" aria-label="Permalink to “9.1 生态系统发展”">​</a></h3><ul><li><strong>工具链集成</strong>：与Vite、Webpack等深度集成</li><li><strong>企业级支持</strong>：更多企业采用pnpm</li><li><strong>社区生态</strong>：插件和工具生态完善</li></ul><h3 id="_9-2-技术演进" tabindex="-1">9.2 技术演进 <a class="header-anchor" href="#_9-2-技术演进" aria-label="Permalink to “9.2 技术演进”">​</a></h3><ul><li><strong>性能优化</strong>：进一步优化安装速度</li><li><strong>功能增强</strong>：更多高级特性</li><li><strong>标准化</strong>：可能成为行业标准</li></ul><hr><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h2><p>pnpm通过创新的存储机制和严格的依赖管理，彻底解决了传统包管理器的痛点：</p><h3 id="核心优势" tabindex="-1">核心优势 <a class="header-anchor" href="#核心优势" aria-label="Permalink to “核心优势”">​</a></h3><ol><li><strong>极致的空间效率</strong>：节省90%以上磁盘空间</li><li><strong>快速的安装速度</strong>：比npm快3-4倍</li><li><strong>严格的依赖管理</strong>：解决幽灵依赖问题</li><li><strong>优秀的开发体验</strong>：工作空间、并行安装等特性</li></ol><h3 id="技术突破" tabindex="-1">技术突破 <a class="header-anchor" href="#技术突破" aria-label="Permalink to “技术突破”">​</a></h3><ol><li><strong>内容寻址存储</strong>：基于哈希的智能存储</li><li><strong>硬链接机制</strong>：避免重复文件</li><li><strong>嵌套依赖树</strong>：清晰的依赖关系</li><li><strong>符号链接</strong>：高效的包访问</li></ol><h3 id="实际价值" tabindex="-1">实际价值 <a class="header-anchor" href="#实际价值" aria-label="Permalink to “实际价值”">​</a></h3><ol><li><strong>降低开发成本</strong>：更快的安装和构建</li><li><strong>提高开发效率</strong>：更好的工具链集成</li><li><strong>增强项目安全性</strong>：严格的依赖控制</li><li><strong>改善团队协作</strong>：一致的依赖管理</li></ol><p>pnpm不仅是一个包管理器，更是现代前端工程化的重要里程碑。它代表了包管理技术的一次革命性突破，为JavaScript生态系统的发展开辟了新的道路。</p><hr><h2 id="引用来源" tabindex="-1">引用来源 <a class="header-anchor" href="#引用来源" aria-label="Permalink to “引用来源”">​</a></h2><ol><li>pnpm官方文档：<a href="https://pnpm.io/" target="_blank" rel="noreferrer">https://pnpm.io/</a></li><li>《Node.js包管理器对比研究》- 计算机工程与应用</li><li>《现代前端工程化实践》- 人民邮电出版社</li><li>npm官方文档：<a href="https://docs.npmjs.com/" target="_blank" rel="noreferrer">https://docs.npmjs.com/</a></li><li>Yarn官方文档：<a href="https://yarnpkg.com/" target="_blank" rel="noreferrer">https://yarnpkg.com/</a></li><li>《JavaScript高级程序设计》- Nicholas C. Zakas</li><li>《深入理解计算机系统》- Randal E. Bryant</li><li>《算法导论》- Thomas H. Cormen</li></ol></div></div></main><footer class="VPDocFooter" data-v-cd9e52ac data-v-c6c7fdfb><!--[--><!--]--><!----><!----></footer><!--[--><!--[--><!--[--><!----><div id="gitalk-container" data-v-921fbe14></div><!----><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"archives.md\":\"DOJosjZG\",\"index.md\":\"ULRTXW6B\",\"posts_algorithm-linked-list-addition.md\":\"RMgt5B3j\",\"posts_backtracking-algorithm.md\":\"DIlr4_tV\",\"posts_block-chain.md\":\"BJiie6yb\",\"posts_browser-cache.md\":\"CcUdJCuQ\",\"posts_browser-rendering.md\":\"CtiJJuq1\",\"posts_code-quality.md\":\"BhZMCH5N\",\"posts_composite-layers.md\":\"C4R4eSF9\",\"posts_dependency-collection.md\":\"ClugAKob\",\"posts_dependency-inversion.md\":\"BRZT4m8E\",\"posts_destructuring.md\":\"BrpwFmAJ\",\"posts_diff.md\":\"Cfwq9jN4\",\"posts_event-loop.md\":\"BjqxtXUZ\",\"posts_function_program.md\":\"Bb5Wgfg2\",\"posts_graphql.md\":\"nBipxVX3\",\"posts_houdini.md\":\"D62PX44B\",\"posts_http-to-https.md\":\"B3amLj8C\",\"posts_js-confuse-concept.md\":\"hjljmss_\",\"posts_network-basics.md\":\"uzVOv89W\",\"posts_nginx.md\":\"ueJpZgsv\",\"posts_pnpm-deep-dive.md\":\"CXWetFIX\",\"posts_programming-skills.md\":\"DCBjZcdC\",\"posts_promise-deep-dive.md\":\"SBHicXR9\",\"posts_ts-design.md\":\"33KRjLmi\",\"posts_virtualdomtorealdom.md\":\"DP8QOJJ8\",\"posts_vue2-reactive-system.md\":\"BjzXzJ6N\",\"readme.md\":\"CaQ9vtvh\",\"tags.md\":\"DMagD9E9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"TSK\",\"description\":\"Home of TSK\",\"base\":\"/blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"avator\":\"https://power-mall-2.oss-cn-beijing.aliyuncs.com/avator.png\",\"posts\":[{\"frontMatter\":{\"title\":\"区块链技术原理\",\"description\":\"深入浅出地解析区块链技术的核心原理，包括密码学基础、共识机制、智能合约等关键技术，帮助读者理解区块链的本质和应用价值\",\"date\":\"2025-08-17\",\"tags\":[\"区块链\",\"密码学\",\"比特币\",\"共识机制\",\"智能合约\"]},\"regularPath\":\"/posts/block-chain.html\"},{\"frontMatter\":{\"title\":\"GraphQL深度解析：从概念到实战应用\",\"description\":\"深入理解GraphQL的核心概念、类型系统、查询语言，并通过实际代码示例掌握客户端开发技巧，让数据查询变得优雅而高效\",\"date\":\"2025-08-14\",\"tags\":[\"GraphQL\",\"API\",\"前端开发\",\"数据查询\",\"现代Web开发\"]},\"regularPath\":\"/posts/GraphQL.html\"},{\"frontMatter\":{\"title\":\"JavaScript 中令人迷惑的语法\",\"date\":\"2025-07-31\",\"tags\":[\"JavaScript\",\"ES6\",\"语法解析\",\"编程技巧\"],\"description\":\"深入解析 JavaScript 中各种令人迷惑的语法，通过 ES5 转换理解其工作原理，掌握现代 JavaScript 语法的核心概念和实际应用场景。\"},\"regularPath\":\"/posts/js-confuse-concept.html\"},{\"frontMatter\":{\"title\":\"HTTPS解决了哪些HTTP的问题：SSL/TLS协议深度解析\",\"date\":\"2025-07-15\",\"tags\":[\"网络协议\",\"网络安全\",\"HTTPS\",\"SSL/TLS\",\"加密传输\"],\"description\":\"深入解析HTTP协议的安全问题，以及SSL/TLS协议如何通过加密、认证和完整性保护来解决这些问题。\"},\"regularPath\":\"/posts/http-to-https.html\"},{\"frontMatter\":{\"title\":\"vue2 响应式系统深度解析：从原理到实现\",\"date\":\"2025-06-24\",\"tags\":[\"vue2\",\"proxy\"]},\"regularPath\":\"/posts/vue2-reactive-system.html\"},{\"frontMatter\":{\"title\":\"函数式编程：从数学思维到现代软件开发\",\"date\":\"2025-06-20\",\"tags\":[\"函数式编程\",\"编程范式\",\"JavaScript\",\"函数式思维\"],\"description\":\"深入探讨函数式编程的核心概念、数学基础、实践应用以及在现代软件开发中的价值。\"},\"regularPath\":\"/posts/function_program.html\"},{\"frontMatter\":{\"title\":\"浏览器渲染中的合成层（Composite Layers）详解\",\"date\":\"2025-03-14\",\"tags\":[\"浏览器渲染\",\"合成层\",\"性能优化\",\"GPU加速\"],\"description\":\"深入浅出地讲解浏览器渲染中的合成层，帮助开发者更好地理解和利用这一机制来优化网页性能。\"},\"regularPath\":\"/posts/composite-layers.html\"},{\"frontMatter\":{\"title\":\"pnpm深度解析：现代包管理器的革命性突破\",\"date\":\"2025-03-13\",\"tags\":[\"包管理器\",\"pnpm\",\"npm\",\"yarn\",\"前端工程化\"],\"description\":\"深入解析pnpm的技术原理、核心优势以及如何解决传统包管理器的痛点。\"},\"regularPath\":\"/posts/pnpm-deep-dive.html\"},{\"frontMatter\":{\"title\":\"网络基础系列 - 网络基础知识\",\"date\":\"2025-03-13\",\"tags\":[\"网络基础\",\"网络原理\",\"网络协议\"],\"description\":\"深入浅出地讲解网络基础知识，包含丰富的代码示例和优化技巧。\"},\"regularPath\":\"/posts/network-basics.html\"},{\"frontMatter\":{\"title\":\"设计模式系列 - 依赖倒置原则详解\",\"date\":\"2025-03-13\",\"tags\":[\"设计模式\",\"依赖倒置原则\",\"面向对象设计\",\"代码重构\"],\"description\":\"深入浅出地讲解依赖倒置原则的核心思想、实现方法及常见应用场景，包含丰富的代码示例和优化技巧。\"},\"regularPath\":\"/posts/dependency-inversion.html\"},{\"frontMatter\":{\"title\":\"算法详解 - 链表两数相加问题\",\"date\":\"2025-03-13\",\"tags\":[\"算法\",\"链表\",\"数据结构\",\"LeetCode\"],\"description\":\"深入解析链表两数相加问题的多种解法，包含详细的代码实现和优化技巧。\"},\"regularPath\":\"/posts/algorithm-linked-list-addition.html\"},{\"frontMatter\":{\"title\":\"算法系列 - 回溯算法详解\",\"date\":\"2025-03-12\",\"tags\":[\"算法\",\"回溯算法\",\"递归\",\"组合问题\",\"排列问题\"],\"description\":\"深入浅出地讲解回溯算法的核心思想、实现方法及常见应用场景，包含丰富的代码示例和优化技巧。\"},\"regularPath\":\"/posts/backtracking-algorithm.html\"},{\"frontMatter\":{\"title\":\"TS系列 - 从设计者的角度理解TypeScript\",\"date\":\"2025-03-07\",\"tags\":[\"TypeScript\",\"类型系统\",\"前端开发\"]},\"regularPath\":\"/posts/ts-design.html\"},{\"frontMatter\":{\"title\":\"日常编程技巧\",\"date\":\"2025-03-07\",\"tags\":[\"TypeScript\",\"类型系统\",\"前端开发\"]},\"regularPath\":\"/posts/programming-skills.html\"},{\"frontMatter\":{\"title\":\"深入浅出事件循环\",\"date\":\"2025-03-03\"},\"regularPath\":\"/posts/event-loop.html\"},{\"frontMatter\":{\"title\":\"Vue3系列 - Diff算法详解：原理与实现\",\"date\":\"2025-03-03\",\"tags\":[\"JavaScript\",\"Vue\",\"Diff算法\",\"性能优化\"]},\"regularPath\":\"/posts/diff.html\"},{\"frontMatter\":{\"title\":\"聊聊代码质量：从实际经验出发\",\"date\":\"2025-03-03\"},\"regularPath\":\"/posts/code-quality.html\"},{\"frontMatter\":{\"title\":\"Vue3系列 - 虚拟DOM到真实DOM\",\"date\":\"2025-03-01\",\"tags\":[\"JavaScript\",\"虚拟DOM\",\"DOM\"]},\"regularPath\":\"/posts/virtualDomToRealDom.html\"},{\"frontMatter\":{\"title\":\"Vue3系列 - 从发布订阅到响应式系统\",\"date\":\"2025-02-28\",\"tags\":[\"JavaScript\",\"Vue\",\"响应式系统\"]},\"regularPath\":\"/posts/dependency-collection.html\"},{\"frontMatter\":{\"title\":\"浏览器缓存详解：从原理到实践\",\"date\":\"2025-02-26\"},\"regularPath\":\"/posts/browser-cache.html\"},{\"frontMatter\":{\"title\":\"探索浏览器呈现过程\",\"date\":\"2025-02-23\"},\"regularPath\":\"/posts/browser-rendering.html\"},{\"frontMatter\":{\"title\":\"Promise深入解析:从零实现Promise\",\"date\":\"2025-02-21\",\"tags\":[\"JavaScript\",\"Promise\",\"异步编程\"]},\"regularPath\":\"/posts/promise-deep-dive.html\"},{\"frontMatter\":{\"title\":\"CSS Houdini：让开发者掌控浏览器渲染的魔法\",\"description\":\"深入浅出地介绍CSS Houdini API，探索如何通过JavaScript自定义CSS渲染过程，实现传统CSS无法实现的复杂布局和动画效果\",\"date\":\"2025-01-27\",\"tags\":[\"CSS\",\"JavaScript\",\"Web API\",\"前端技术\"]},\"regularPath\":\"/posts/houdini.html\"},{\"frontMatter\":{\"title\":\"深入理解Nginx\",\"date\":\"2024-03-13\",\"tags\":[\"Nginx\",\"服务器\",\"反向代理\"]},\"regularPath\":\"/posts/nginx.html\"},{\"frontMatter\":{\"title\":\"深入理解解构赋值及其原理\",\"date\":\"2024-03-12\",\"tags\":[\"JavaScript\",\"解构赋值\",\"Babel\"]},\"regularPath\":\"/posts/destructuring.html\"}],\"pageSize\":5,\"postLength\":25,\"nav\":[{\"text\":\"🏡Blogs\",\"link\":\"/\"},{\"text\":\"🔖Tags\",\"link\":\"/tags\"},{\"text\":\"📃Archives\",\"link\":\"/archives\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/tangtts\"},{\"icon\":\"twitter\",\"link\":\"https://x.com/home?locale=zh-cn\"},{\"icon\":{\"svg\":\"<svg role=\\\"img\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\">\\n          <path d=\\\"M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z\\\" ></path>\\n          </svg>\"},\"link\":\"mailto:tskwangyi@gmail.com\"}],\"aside\":false},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>